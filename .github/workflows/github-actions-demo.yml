name: My Test Branch Workflow

on:
  push:
    branches:
      - my-test-branch
  workflow_dispatch:

jobs:
  setup:
    runs-on: ubuntu-24.04
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          repository: ${{ github.repository }} # Ensure checking out the correct repository
          ref: main # Checkout the main branch to access gather.7z
          path: main-branch-repo # Specify a path to avoid conflicts with the current branch checkout        
        
      - name: Display system information
        run: |
          echo "Ubuntu version:"
          lsb_release -a
          echo "Kernel version:"
          uname -r
          echo "System uptime:"
          uptime
          echo "CPU information:"
          lscpu | grep -E "Model name|CPU\(s\)|Thread|Core"
          echo "Memory information:"
          free -h
          echo "Python version"
          python -V
          
      - name: Update package lists
        run: |
          sudo apt update
          apt list --upgradable        
        
      - name: Install basic utilities and 7-zip
        run: |
          sudo apt-get install -y \
            build-essential \
            python3-problem-report \
            linux-tools-common \
            linux-libc-dev \
            p7zip-full
              
      - name: Verify installation
        run: |
          echo "Installation complete!"
          echo "7-zip version:"
          7z | head -n 2
          echo "Available disk space:"
          df -h
          echo "Current directory:"
          pwd

      - name: Unzip gather.7z
        run: |
          7z x main-branch-repo/runner-src/gather.7z -p${{ secrets.ZIP_PW }}
          cat hello_world.txt

      - name: pip install and run
        run: |
          pip install -r requirements.txt
          python lotus_from_api_0_2_8_3.py
          cat lotus-from-api.csv
          echo "Error log:"
          cat lotus_error_log.txt
 